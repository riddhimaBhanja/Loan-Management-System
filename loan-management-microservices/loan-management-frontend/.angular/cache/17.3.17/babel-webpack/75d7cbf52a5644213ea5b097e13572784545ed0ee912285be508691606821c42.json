{"ast":null,"code":"import { signal } from '@angular/core';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '@environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.API_URL = `${environment.apiUrl}/auth`;\n    this.currentUserSubject = new BehaviorSubject(this.getUserFromStorage());\n    this.currentUser$ = this.currentUserSubject.asObservable();\n    this.isAuthenticated = signal(this.hasValidToken());\n  }\n  register(request) {\n    return this.http.post(`${this.API_URL}/register`, request).pipe(tap(response => {\n      if (response.success && response.data) {\n        this.handleAuthResponse(response.data);\n      }\n    }));\n  }\n  login(request) {\n    return this.http.post(`${this.API_URL}/login`, request).pipe(tap(response => {\n      if (response.success && response.data) {\n        this.handleAuthResponse(response.data);\n      }\n    }));\n  }\n  refreshToken() {\n    const refreshToken = this.getRefreshToken();\n    if (!refreshToken) {\n      throw new Error('No refresh token available');\n    }\n    const request = {\n      refreshToken\n    };\n    return this.http.post(`${this.API_URL}/refresh`, request).pipe(tap(response => {\n      if (response.success && response.data) {\n        this.handleAuthResponse(response.data);\n      }\n    }));\n  }\n  logout() {\n    const token = this.getAccessToken();\n    if (token) {\n      this.http.post(`${this.API_URL}/logout`, {}).subscribe({\n        next: () => this.clearAuthData(),\n        error: () => this.clearAuthData() // Clear even on error\n      });\n    } else {\n      this.clearAuthData();\n    }\n  }\n  handleAuthResponse(authResponse) {\n    localStorage.setItem(environment.tokenKey, authResponse.accessToken);\n    localStorage.setItem(environment.refreshTokenKey, authResponse.refreshToken);\n    localStorage.setItem(environment.userKey, JSON.stringify(authResponse.user));\n    this.currentUserSubject.next(authResponse.user);\n    this.isAuthenticated.set(true);\n  }\n  clearAuthData() {\n    localStorage.removeItem(environment.tokenKey);\n    localStorage.removeItem(environment.refreshTokenKey);\n    localStorage.removeItem(environment.userKey);\n    this.currentUserSubject.next(null);\n    this.isAuthenticated.set(false);\n    this.router.navigate(['/auth/login']);\n  }\n  getAccessToken() {\n    return localStorage.getItem(environment.tokenKey);\n  }\n  getRefreshToken() {\n    return localStorage.getItem(environment.refreshTokenKey);\n  }\n  getCurrentUser() {\n    return this.currentUserSubject.value;\n  }\n  getUserFromStorage() {\n    const userJson = localStorage.getItem(environment.userKey);\n    return userJson ? JSON.parse(userJson) : null;\n  }\n  hasValidToken() {\n    return !!this.getAccessToken();\n  }\n  hasRole(role) {\n    const user = this.getCurrentUser();\n    return user ? user.roles.includes(role) : false;\n  }\n  hasAnyRole(roles) {\n    const user = this.getCurrentUser();\n    if (!user) return false;\n    return roles.some(role => user.roles.includes(role));\n  }\n  isAdmin() {\n    return this.hasRole('ADMIN');\n  }\n  isLoanOfficer() {\n    return this.hasRole('LOAN_OFFICER');\n  }\n  isCustomer() {\n    return this.hasRole('CUSTOMER');\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","BehaviorSubject","tap","environment","AuthService","constructor","http","router","API_URL","apiUrl","currentUserSubject","getUserFromStorage","currentUser$","asObservable","isAuthenticated","hasValidToken","register","request","post","pipe","response","success","data","handleAuthResponse","login","refreshToken","getRefreshToken","Error","logout","token","getAccessToken","subscribe","next","clearAuthData","error","authResponse","localStorage","setItem","tokenKey","accessToken","refreshTokenKey","userKey","JSON","stringify","user","set","removeItem","navigate","getItem","getCurrentUser","value","userJson","parse","hasRole","role","roles","includes","hasAnyRole","some","isAdmin","isLoanOfficer","isCustomer","i0","ɵɵinject","i1","HttpClient","i2","Router","factory","ɵfac","providedIn"],"sources":["C:\\Users\\KIIT\\Desktop\\Loan Management System\\loan-management-frontend\\src\\app\\core\\services\\auth.service.ts"],"sourcesContent":["import { Injectable, signal } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { Observable, BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '@environments/environment';\nimport {\n  User,\n  RegisterRequest,\n  LoginRequest,\n  AuthResponse,\n  RefreshTokenRequest\n} from '../models/user.model';\nimport { ApiResponse } from '../models/api-response.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private readonly API_URL = `${environment.apiUrl}/auth`;\n  private currentUserSubject = new BehaviorSubject<User | null>(this.getUserFromStorage());\n  public currentUser$ = this.currentUserSubject.asObservable();\n  public isAuthenticated = signal<boolean>(this.hasValidToken());\n\n  constructor(\n    private http: HttpClient,\n    private router: Router\n  ) {}\n\n  register(request: RegisterRequest): Observable<ApiResponse<AuthResponse>> {\n    return this.http.post<ApiResponse<AuthResponse>>(`${this.API_URL}/register`, request)\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.handleAuthResponse(response.data);\n          }\n        })\n      );\n  }\n\n  login(request: LoginRequest): Observable<ApiResponse<AuthResponse>> {\n    return this.http.post<ApiResponse<AuthResponse>>(`${this.API_URL}/login`, request)\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.handleAuthResponse(response.data);\n          }\n        })\n      );\n  }\n\n  refreshToken(): Observable<ApiResponse<AuthResponse>> {\n    const refreshToken = this.getRefreshToken();\n    if (!refreshToken) {\n      throw new Error('No refresh token available');\n    }\n\n    const request: RefreshTokenRequest = { refreshToken };\n    return this.http.post<ApiResponse<AuthResponse>>(`${this.API_URL}/refresh`, request)\n      .pipe(\n        tap(response => {\n          if (response.success && response.data) {\n            this.handleAuthResponse(response.data);\n          }\n        })\n      );\n  }\n\n  logout(): void {\n    const token = this.getAccessToken();\n    if (token) {\n      this.http.post(`${this.API_URL}/logout`, {}).subscribe({\n        next: () => this.clearAuthData(),\n        error: () => this.clearAuthData() // Clear even on error\n      });\n    } else {\n      this.clearAuthData();\n    }\n  }\n\n  private handleAuthResponse(authResponse: AuthResponse): void {\n    localStorage.setItem(environment.tokenKey, authResponse.accessToken);\n    localStorage.setItem(environment.refreshTokenKey, authResponse.refreshToken);\n    localStorage.setItem(environment.userKey, JSON.stringify(authResponse.user));\n    this.currentUserSubject.next(authResponse.user);\n    this.isAuthenticated.set(true);\n  }\n\n  private clearAuthData(): void {\n    localStorage.removeItem(environment.tokenKey);\n    localStorage.removeItem(environment.refreshTokenKey);\n    localStorage.removeItem(environment.userKey);\n    this.currentUserSubject.next(null);\n    this.isAuthenticated.set(false);\n    this.router.navigate(['/auth/login']);\n  }\n\n  getAccessToken(): string | null {\n    return localStorage.getItem(environment.tokenKey);\n  }\n\n  getRefreshToken(): string | null {\n    return localStorage.getItem(environment.refreshTokenKey);\n  }\n\n  getCurrentUser(): User | null {\n    return this.currentUserSubject.value;\n  }\n\n  private getUserFromStorage(): User | null {\n    const userJson = localStorage.getItem(environment.userKey);\n    return userJson ? JSON.parse(userJson) : null;\n  }\n\n  private hasValidToken(): boolean {\n    return !!this.getAccessToken();\n  }\n\n  hasRole(role: string): boolean {\n    const user = this.getCurrentUser();\n    return user ? user.roles.includes(role) : false;\n  }\n\n  hasAnyRole(roles: string[]): boolean {\n    const user = this.getCurrentUser();\n    if (!user) return false;\n    return roles.some(role => user.roles.includes(role));\n  }\n\n  isAdmin(): boolean {\n    return this.hasRole('ADMIN');\n  }\n\n  isLoanOfficer(): boolean {\n    return this.hasRole('LOAN_OFFICER');\n  }\n\n  isCustomer(): boolean {\n    return this.hasRole('CUSTOMER');\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}