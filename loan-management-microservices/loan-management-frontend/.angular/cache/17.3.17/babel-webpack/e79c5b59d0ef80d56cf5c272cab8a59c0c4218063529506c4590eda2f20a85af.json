{"ast":null,"code":"import { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatNativeDateModule } from '@angular/material/core';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { PaymentMethod } from '@core/models/emi.model';\nimport { InrCurrencyPipe } from '@shared/pipes/inr-currency.pipe';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@core/services/emi.service\";\nimport * as i4 from \"@angular/material/snack-bar\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/form-field\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/select\";\nimport * as i9 from \"@angular/material/core\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@angular/material/datepicker\";\nimport * as i12 from \"@angular/material/progress-spinner\";\nconst _forTrack0 = ($index, $item) => $item.value;\nfunction PaymentDialogComponent_Conditional_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please enter a valid payment amount (greater than 0)\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_Conditional_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Payment date is required\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_For_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const method_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", method_r2.value);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(method_r2.label);\n  }\n}\nfunction PaymentDialogComponent_Conditional_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please select a payment method\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_mat_hint_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-hint\");\n    i0.ɵɵtext(1, \"Optional - Transaction ID, Cheque number, etc.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_mat_hint_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-hint\");\n    i0.ɵɵtext(1, \"Required - Transaction ID, Cheque/DD number, UTR, etc.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_Conditional_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Transaction reference is required for this payment method\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PaymentDialogComponent_Conditional_64_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\", 21);\n  }\n}\nfunction PaymentDialogComponent_Conditional_65_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Record Payment\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let PaymentDialogComponent = /*#__PURE__*/(() => {\n  class PaymentDialogComponent {\n    constructor(fb, dialogRef, emiService, snackBar, data) {\n      this.fb = fb;\n      this.dialogRef = dialogRef;\n      this.emiService = emiService;\n      this.snackBar = snackBar;\n      this.data = data;\n      this.isSubmitting = signal(false);\n      this.paymentMethods = [{\n        value: PaymentMethod.CASH,\n        label: 'Cash'\n      }, {\n        value: PaymentMethod.CHEQUE,\n        label: 'Cheque'\n      }, {\n        value: PaymentMethod.NEFT,\n        label: 'NEFT'\n      }, {\n        value: PaymentMethod.RTGS,\n        label: 'RTGS'\n      }, {\n        value: PaymentMethod.UPI,\n        label: 'UPI'\n      }, {\n        value: PaymentMethod.DEBIT_CARD,\n        label: 'Debit Card'\n      }, {\n        value: PaymentMethod.CREDIT_CARD,\n        label: 'Credit Card'\n      }, {\n        value: PaymentMethod.NET_BANKING,\n        label: 'Net Banking'\n      }, {\n        value: PaymentMethod.DEMAND_DRAFT,\n        label: 'Demand Draft'\n      }];\n      this.paymentForm = this.fb.group({\n        paymentAmount: [data.emiSchedule.totalEmi, [Validators.required, Validators.min(0.01)]],\n        paymentDate: [new Date(), Validators.required],\n        paymentMethod: ['', Validators.required],\n        transactionReference: ['', Validators.maxLength(100)],\n        remarks: ['', Validators.maxLength(500)]\n      });\n      // Listen to payment method changes to update transaction reference validation\n      this.paymentForm.get('paymentMethod')?.valueChanges.subscribe(method => {\n        const transactionRefControl = this.paymentForm.get('transactionReference');\n        if (method === PaymentMethod.CASH) {\n          // Cash doesn't require transaction reference\n          transactionRefControl?.clearValidators();\n          transactionRefControl?.setValidators([Validators.maxLength(100)]);\n        } else {\n          // All other methods require transaction reference\n          transactionRefControl?.setValidators([Validators.required, Validators.maxLength(100)]);\n        }\n        transactionRefControl?.updateValueAndValidity();\n      });\n    }\n    onCancel() {\n      this.dialogRef.close();\n    }\n    onSubmit() {\n      if (this.paymentForm.valid) {\n        this.isSubmitting.set(true);\n        const formValue = this.paymentForm.value;\n        const paymentRequest = {\n          emiScheduleId: this.data.emiSchedule.id,\n          amount: formValue.paymentAmount,\n          paymentDate: this.formatDate(formValue.paymentDate),\n          paymentMethod: formValue.paymentMethod,\n          transactionReference: formValue.transactionReference && formValue.transactionReference.trim() !== '' ? formValue.transactionReference.trim() : formValue.paymentMethod === PaymentMethod.CASH ? '' : formValue.transactionReference,\n          remarks: formValue.remarks || undefined\n        };\n        this.emiService.recordPayment(paymentRequest).subscribe({\n          next: response => {\n            if (response.success) {\n              this.snackBar.open('Payment recorded successfully', 'Close', {\n                duration: 3000,\n                panelClass: ['success-snackbar']\n              });\n              this.dialogRef.close(true);\n            }\n            this.isSubmitting.set(false);\n          },\n          error: error => {\n            console.error('Error recording payment:', error);\n            this.snackBar.open(error.error?.message || 'Failed to record payment. Please try again.', 'Close', {\n              duration: 5000,\n              panelClass: ['error-snackbar']\n            });\n            this.isSubmitting.set(false);\n          }\n        });\n      }\n    }\n    formatDate(date) {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    }\n    static {\n      this.ɵfac = function PaymentDialogComponent_Factory(t) {\n        return new (t || PaymentDialogComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatDialogRef), i0.ɵɵdirectiveInject(i3.EmiService), i0.ɵɵdirectiveInject(i4.MatSnackBar), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: PaymentDialogComponent,\n        selectors: [[\"app-payment-dialog\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 66,\n        vars: 24,\n        consts: [[\"picker\", \"\"], [\"mat-dialog-title\", \"\"], [1, \"payment-info\"], [1, \"info-row\"], [1, \"label\"], [1, \"value\"], [1, \"value\", \"amount\"], [1, \"payment-form\", 3, \"formGroup\"], [\"appearance\", \"outline\", 1, \"full-width\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"paymentAmount\", \"placeholder\", \"Enter payment amount\"], [\"matPrefix\", \"\"], [\"matInput\", \"\", \"formControlName\", \"paymentDate\", \"placeholder\", \"Select payment date\", 3, \"matDatepicker\"], [\"matSuffix\", \"\", 3, \"for\"], [\"formControlName\", \"paymentMethod\"], [3, \"value\"], [\"matInput\", \"\", \"formControlName\", \"transactionReference\", \"placeholder\", \"Enter transaction/cheque number\", \"maxlength\", \"100\"], [4, \"ngIf\"], [\"matInput\", \"\", \"formControlName\", \"remarks\", \"rows\", \"3\", \"placeholder\", \"Additional notes (optional)\", \"maxlength\", \"500\"], [\"align\", \"end\"], [\"mat-button\", \"\", 3, \"click\", \"disabled\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"diameter\", \"20\"]],\n        template: function PaymentDialogComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"h2\", 1);\n            i0.ɵɵtext(1, \"Record EMI Payment\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"mat-dialog-content\")(3, \"div\", 2)(4, \"div\", 3)(5, \"span\", 4);\n            i0.ɵɵtext(6, \"EMI Number:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"span\", 5);\n            i0.ɵɵtext(8);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 3)(10, \"span\", 4);\n            i0.ɵɵtext(11, \"Due Date:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"span\", 5);\n            i0.ɵɵtext(13);\n            i0.ɵɵpipe(14, \"date\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(15, \"div\", 3)(16, \"span\", 4);\n            i0.ɵɵtext(17, \"EMI Amount:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"span\", 6);\n            i0.ɵɵtext(19);\n            i0.ɵɵpipe(20, \"inrCurrency\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(21, \"form\", 7)(22, \"mat-form-field\", 8)(23, \"mat-label\");\n            i0.ɵɵtext(24, \"Payment Amount\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(25, \"input\", 9);\n            i0.ɵɵelementStart(26, \"span\", 10);\n            i0.ɵɵtext(27, \"\\u20B9\\u00A0\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"mat-hint\");\n            i0.ɵɵtext(29);\n            i0.ɵɵpipe(30, \"inrCurrency\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(31, PaymentDialogComponent_Conditional_31_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(32, \"mat-form-field\", 8)(33, \"mat-label\");\n            i0.ɵɵtext(34, \"Payment Date\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(35, \"input\", 11)(36, \"mat-datepicker-toggle\", 12)(37, \"mat-datepicker\", null, 0);\n            i0.ɵɵtemplate(39, PaymentDialogComponent_Conditional_39_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(40, \"mat-form-field\", 8)(41, \"mat-label\");\n            i0.ɵɵtext(42, \"Payment Method\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(43, \"mat-select\", 13);\n            i0.ɵɵrepeaterCreate(44, PaymentDialogComponent_For_45_Template, 2, 2, \"mat-option\", 14, _forTrack0);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(46, PaymentDialogComponent_Conditional_46_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(47, \"mat-form-field\", 8)(48, \"mat-label\");\n            i0.ɵɵtext(49, \"Transaction Reference\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(50, \"input\", 15);\n            i0.ɵɵtemplate(51, PaymentDialogComponent_mat_hint_51_Template, 2, 0, \"mat-hint\", 16)(52, PaymentDialogComponent_mat_hint_52_Template, 2, 0, \"mat-hint\", 16)(53, PaymentDialogComponent_Conditional_53_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(54, \"mat-form-field\", 8)(55, \"mat-label\");\n            i0.ɵɵtext(56, \"Remarks\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(57, \"textarea\", 17);\n            i0.ɵɵelementStart(58, \"mat-hint\");\n            i0.ɵɵtext(59);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(60, \"mat-dialog-actions\", 18)(61, \"button\", 19);\n            i0.ɵɵlistener(\"click\", function PaymentDialogComponent_Template_button_click_61_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onCancel());\n            });\n            i0.ɵɵtext(62, \"Cancel\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(63, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function PaymentDialogComponent_Template_button_click_63_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onSubmit());\n            });\n            i0.ɵɵtemplate(64, PaymentDialogComponent_Conditional_64_Template, 1, 0, \"mat-spinner\", 21)(65, PaymentDialogComponent_Conditional_65_Template, 2, 0);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            let tmp_6_0;\n            let tmp_9_0;\n            let tmp_11_0;\n            let tmp_12_0;\n            let tmp_13_0;\n            let tmp_14_0;\n            let tmp_15_0;\n            const picker_r3 = i0.ɵɵreference(38);\n            i0.ɵɵadvance(8);\n            i0.ɵɵtextInterpolate(ctx.data.emiSchedule.installmentNumber);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(14, 17, ctx.data.emiSchedule.dueDate, \"dd MMM yyyy\"));\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(20, 20, ctx.data.emiSchedule.totalEmi));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"formGroup\", ctx.paymentForm);\n            i0.ɵɵadvance(8);\n            i0.ɵɵtextInterpolate1(\"EMI Amount: \", i0.ɵɵpipeBind1(30, 22, ctx.data.emiSchedule.totalEmi), \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵconditional(31, ((tmp_6_0 = ctx.paymentForm.get(\"paymentAmount\")) == null ? null : tmp_6_0.invalid) && ((tmp_6_0 = ctx.paymentForm.get(\"paymentAmount\")) == null ? null : tmp_6_0.touched) ? 31 : -1);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"matDatepicker\", picker_r3);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"for\", picker_r3);\n            i0.ɵɵadvance(3);\n            i0.ɵɵconditional(39, ((tmp_9_0 = ctx.paymentForm.get(\"paymentDate\")) == null ? null : tmp_9_0.invalid) && ((tmp_9_0 = ctx.paymentForm.get(\"paymentDate\")) == null ? null : tmp_9_0.touched) ? 39 : -1);\n            i0.ɵɵadvance(5);\n            i0.ɵɵrepeater(ctx.paymentMethods);\n            i0.ɵɵadvance(2);\n            i0.ɵɵconditional(46, ((tmp_11_0 = ctx.paymentForm.get(\"paymentMethod\")) == null ? null : tmp_11_0.invalid) && ((tmp_11_0 = ctx.paymentForm.get(\"paymentMethod\")) == null ? null : tmp_11_0.touched) ? 46 : -1);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ((tmp_12_0 = ctx.paymentForm.get(\"paymentMethod\")) == null ? null : tmp_12_0.value) === \"CASH\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ((tmp_13_0 = ctx.paymentForm.get(\"paymentMethod\")) == null ? null : tmp_13_0.value) && ((tmp_13_0 = ctx.paymentForm.get(\"paymentMethod\")) == null ? null : tmp_13_0.value) !== \"CASH\");\n            i0.ɵɵadvance();\n            i0.ɵɵconditional(53, ((tmp_14_0 = ctx.paymentForm.get(\"transactionReference\")) == null ? null : tmp_14_0.invalid) && ((tmp_14_0 = ctx.paymentForm.get(\"transactionReference\")) == null ? null : tmp_14_0.touched) ? 53 : -1);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate1(\"\", ((tmp_15_0 = ctx.paymentForm.get(\"remarks\")) == null ? null : tmp_15_0.value == null ? null : tmp_15_0.value.length) || 0, \"/500\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.isSubmitting());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.paymentForm.invalid || ctx.isSubmitting());\n            i0.ɵɵadvance();\n            i0.ɵɵconditional(64, ctx.isSubmitting() ? 64 : 65);\n          }\n        },\n        dependencies: [CommonModule, i5.NgIf, i5.DatePipe, ReactiveFormsModule, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.MaxLengthValidator, i1.FormGroupDirective, i1.FormControlName, MatDialogModule, i2.MatDialogTitle, i2.MatDialogActions, i2.MatDialogContent, MatFormFieldModule, i6.MatFormField, i6.MatLabel, i6.MatHint, i6.MatError, i6.MatPrefix, i6.MatSuffix, MatInputModule, i7.MatInput, MatSelectModule, i8.MatSelect, i9.MatOption, MatButtonModule, i10.MatButton, MatDatepickerModule, i11.MatDatepicker, i11.MatDatepickerInput, i11.MatDatepickerToggle, MatNativeDateModule, MatProgressSpinnerModule, i12.MatProgressSpinner, MatSnackBarModule, InrCurrencyPipe],\n        styles: [\".payment-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea14,#764ba214);border-radius:12px;padding:20px;margin-bottom:24px;border:1px solid rgba(102,126,234,.2)}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0}.info-row[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid rgba(0,0,0,.08)}.label[_ngcontent-%COMP%]{font-weight:500;color:#000000b3;font-size:14px}.value[_ngcontent-%COMP%]{font-weight:600;color:#000000de;font-size:15px}.value.amount[_ngcontent-%COMP%]{color:#667eea;font-size:18px}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;max-width:600px;padding:24px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;gap:12px}mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin:0 auto}  .mat-mdc-dialog-container{border-radius:16px}\"]\n      });\n    }\n  }\n  return PaymentDialogComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}