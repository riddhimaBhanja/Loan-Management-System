{"ast":null,"code":"import { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatNativeDateModule } from '@angular/material/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@core/services/loan.service\";\nimport * as i4 from \"@angular/material/snack-bar\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/form-field\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/progress-spinner\";\nimport * as i10 from \"@angular/material/select\";\nimport * as i11 from \"@angular/material/core\";\nimport * as i12 from \"@angular/material/datepicker\";\nimport * as i13 from \"@angular/material/icon\";\nfunction LoanDisburseDialogComponent_Conditional_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Disbursement date is required\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoanDisburseDialogComponent_Conditional_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Disbursement method is required\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoanDisburseDialogComponent_div_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"account_balance\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h4\");\n    i0.ɵɵtext(4, \"Bank Account Details\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LoanDisburseDialogComponent_mat_form_field_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-form-field\", 7)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Account Number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"input\", 27);\n    i0.ɵɵelementStart(4, \"mat-hint\");\n    i0.ɵɵtext(5, \"Enter the customer's bank account number\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LoanDisburseDialogComponent_mat_form_field_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-form-field\", 7)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Bank Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"input\", 28);\n    i0.ɵɵelementStart(4, \"mat-hint\");\n    i0.ɵɵtext(5, \"e.g., HDFC Bank, State Bank of India\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LoanDisburseDialogComponent_mat_form_field_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-form-field\", 7)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"IFSC Code\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"input\", 29);\n    i0.ɵɵelementStart(4, \"mat-hint\");\n    i0.ɵɵtext(5, \"11-character bank IFSC code\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LoanDisburseDialogComponent_Conditional_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\", 25);\n  }\n}\nfunction LoanDisburseDialogComponent_Conditional_69_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Disburse Loan\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let LoanDisburseDialogComponent = /*#__PURE__*/(() => {\n  class LoanDisburseDialogComponent {\n    constructor(fb, dialogRef, loanService, snackBar, data) {\n      this.fb = fb;\n      this.dialogRef = dialogRef;\n      this.loanService = loanService;\n      this.snackBar = snackBar;\n      this.data = data;\n      this.isSubmitting = signal(false);\n      this.disburseForm = this.createForm();\n    }\n    createForm() {\n      return this.fb.group({\n        disbursementDate: [new Date(), [Validators.required]],\n        disbursementMethod: ['', [Validators.required, Validators.maxLength(50)]],\n        accountNumber: ['', [Validators.maxLength(20)]],\n        bankName: ['', [Validators.maxLength(100)]],\n        ifscCode: ['', [Validators.maxLength(11)]],\n        referenceNumber: ['', [Validators.maxLength(100)]],\n        remarks: ['', [Validators.maxLength(500)]]\n      });\n    }\n    showBankFields() {\n      const method = this.disburseForm.get('disbursementMethod')?.value;\n      return ['BANK_TRANSFER', 'RTGS', 'NEFT', 'IMPS', 'ONLINE_PAYMENT'].includes(method);\n    }\n    onCancel() {\n      this.dialogRef.close();\n    }\n    onSubmit() {\n      if (this.disburseForm.valid) {\n        this.isSubmitting.set(true);\n        this.disburseLoan();\n      }\n    }\n    disburseLoan() {\n      const formValue = this.disburseForm.value;\n      // Format the date to YYYY-MM-DD\n      const disbursementDate = new Date(formValue.disbursementDate);\n      const formattedDate = disbursementDate.toISOString().split('T')[0];\n      const request = {\n        disbursementDate: formattedDate,\n        disbursementMethod: formValue.disbursementMethod,\n        accountNumber: formValue.accountNumber || undefined,\n        bankName: formValue.bankName || undefined,\n        ifscCode: formValue.ifscCode || undefined,\n        referenceNumber: formValue.referenceNumber || undefined,\n        remarks: formValue.remarks || undefined\n      };\n      this.loanService.disburseLoan(this.data.loan.id, request).subscribe({\n        next: response => {\n          if (response.success) {\n            this.snackBar.open('Loan disbursed successfully. EMI schedule has been generated.', 'Close', {\n              duration: 5000,\n              panelClass: ['success-snackbar']\n            });\n            this.dialogRef.close(true);\n          }\n          this.isSubmitting.set(false);\n        },\n        error: error => {\n          console.error('Error disbursing loan:', error);\n          // Extract error message - the error interceptor has already processed it\n          const errorMessage = error?.message || 'Failed to disburse loan. Please try again.';\n          this.snackBar.open(errorMessage, 'Close', {\n            duration: 5000,\n            panelClass: ['error-snackbar']\n          });\n          this.isSubmitting.set(false);\n        }\n      });\n    }\n    static {\n      this.ɵfac = function LoanDisburseDialogComponent_Factory(t) {\n        return new (t || LoanDisburseDialogComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatDialogRef), i0.ɵɵdirectiveInject(i3.LoanService), i0.ɵɵdirectiveInject(i4.MatSnackBar), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LoanDisburseDialogComponent,\n        selectors: [[\"app-loan-disburse-dialog\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 70,\n        vars: 19,\n        consts: [[\"picker\", \"\"], [\"mat-dialog-title\", \"\"], [1, \"loan-info\"], [1, \"info-row\"], [1, \"label\"], [1, \"value\"], [1, \"disburse-form\", 3, \"formGroup\"], [\"appearance\", \"outline\", 1, \"full-width\"], [\"matInput\", \"\", \"formControlName\", \"disbursementDate\", \"placeholder\", \"Select date\", 3, \"matDatepicker\"], [\"matIconSuffix\", \"\", 3, \"for\"], [\"formControlName\", \"disbursementMethod\", \"placeholder\", \"Select method\"], [\"value\", \"BANK_TRANSFER\"], [\"value\", \"CHEQUE\"], [\"value\", \"CASH\"], [\"value\", \"ONLINE_PAYMENT\"], [\"value\", \"RTGS\"], [\"value\", \"NEFT\"], [\"value\", \"IMPS\"], [\"class\", \"section-header\", 4, \"ngIf\"], [\"appearance\", \"outline\", \"class\", \"full-width\", 4, \"ngIf\"], [\"matInput\", \"\", \"formControlName\", \"referenceNumber\", \"placeholder\", \"Transaction/Reference Number\", \"maxlength\", \"100\"], [\"matInput\", \"\", \"formControlName\", \"remarks\", \"rows\", \"3\", \"placeholder\", \"Additional remarks (optional)\", \"maxlength\", \"500\"], [\"align\", \"end\"], [\"mat-button\", \"\", 3, \"click\", \"disabled\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"diameter\", \"20\"], [1, \"section-header\"], [\"matInput\", \"\", \"formControlName\", \"accountNumber\", \"placeholder\", \"Customer's bank account number\", \"maxlength\", \"20\"], [\"matInput\", \"\", \"formControlName\", \"bankName\", \"placeholder\", \"Name of the bank\", \"maxlength\", \"100\"], [\"matInput\", \"\", \"formControlName\", \"ifscCode\", \"placeholder\", \"Bank IFSC code\", \"maxlength\", \"11\"]],\n        template: function LoanDisburseDialogComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"h2\", 1);\n            i0.ɵɵtext(1, \"Disburse Loan\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"mat-dialog-content\")(3, \"div\", 2)(4, \"div\", 3)(5, \"span\", 4);\n            i0.ɵɵtext(6, \"Application Number:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"span\", 5);\n            i0.ɵɵtext(8);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 3)(10, \"span\", 4);\n            i0.ɵɵtext(11, \"Customer:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"span\", 5);\n            i0.ɵɵtext(13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 3)(15, \"span\", 4);\n            i0.ɵɵtext(16, \"Approved Amount:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"span\", 5);\n            i0.ɵɵtext(18);\n            i0.ɵɵpipe(19, \"number\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(20, \"form\", 6)(21, \"mat-form-field\", 7)(22, \"mat-label\");\n            i0.ɵɵtext(23, \"Disbursement Date\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(24, \"input\", 8)(25, \"mat-datepicker-toggle\", 9)(26, \"mat-datepicker\", null, 0);\n            i0.ɵɵtemplate(28, LoanDisburseDialogComponent_Conditional_28_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"mat-form-field\", 7)(30, \"mat-label\");\n            i0.ɵɵtext(31, \"Disbursement Method\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(32, \"mat-select\", 10)(33, \"mat-option\", 11);\n            i0.ɵɵtext(34, \"Bank Transfer\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(35, \"mat-option\", 12);\n            i0.ɵɵtext(36, \"Cheque\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(37, \"mat-option\", 13);\n            i0.ɵɵtext(38, \"Cash\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(39, \"mat-option\", 14);\n            i0.ɵɵtext(40, \"Online Payment\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(41, \"mat-option\", 15);\n            i0.ɵɵtext(42, \"RTGS\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(43, \"mat-option\", 16);\n            i0.ɵɵtext(44, \"NEFT\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(45, \"mat-option\", 17);\n            i0.ɵɵtext(46, \"IMPS\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(47, LoanDisburseDialogComponent_Conditional_47_Template, 2, 0, \"mat-error\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(48, LoanDisburseDialogComponent_div_48_Template, 5, 0, \"div\", 18)(49, LoanDisburseDialogComponent_mat_form_field_49_Template, 6, 0, \"mat-form-field\", 19)(50, LoanDisburseDialogComponent_mat_form_field_50_Template, 6, 0, \"mat-form-field\", 19)(51, LoanDisburseDialogComponent_mat_form_field_51_Template, 6, 0, \"mat-form-field\", 19);\n            i0.ɵɵelementStart(52, \"mat-form-field\", 7)(53, \"mat-label\");\n            i0.ɵɵtext(54, \"Reference Number\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(55, \"input\", 20);\n            i0.ɵɵelementStart(56, \"mat-hint\");\n            i0.ɵɵtext(57, \"Optional - Enter transaction or reference number\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(58, \"mat-form-field\", 7)(59, \"mat-label\");\n            i0.ɵɵtext(60, \"Remarks\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(61, \"textarea\", 21);\n            i0.ɵɵelementStart(62, \"mat-hint\");\n            i0.ɵɵtext(63);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(64, \"mat-dialog-actions\", 22)(65, \"button\", 23);\n            i0.ɵɵlistener(\"click\", function LoanDisburseDialogComponent_Template_button_click_65_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onCancel());\n            });\n            i0.ɵɵtext(66, \"Cancel\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(67, \"button\", 24);\n            i0.ɵɵlistener(\"click\", function LoanDisburseDialogComponent_Template_button_click_67_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onSubmit());\n            });\n            i0.ɵɵtemplate(68, LoanDisburseDialogComponent_Conditional_68_Template, 1, 0, \"mat-spinner\", 25)(69, LoanDisburseDialogComponent_Conditional_69_Template, 2, 0);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            let tmp_7_0;\n            let tmp_8_0;\n            let tmp_13_0;\n            const picker_r2 = i0.ɵɵreference(27);\n            i0.ɵɵadvance(8);\n            i0.ɵɵtextInterpolate(ctx.data.loan.applicationNumber);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.data.loan.customerName);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate1(\"\\u20B9\", i0.ɵɵpipeBind2(19, 16, ctx.data.loan.approvedAmount, \"1.2-2\"), \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"formGroup\", ctx.disburseForm);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"matDatepicker\", picker_r2);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"for\", picker_r2);\n            i0.ɵɵadvance(3);\n            i0.ɵɵconditional(28, ((tmp_7_0 = ctx.disburseForm.get(\"disbursementDate\")) == null ? null : tmp_7_0.invalid) && ((tmp_7_0 = ctx.disburseForm.get(\"disbursementDate\")) == null ? null : tmp_7_0.touched) ? 28 : -1);\n            i0.ɵɵadvance(19);\n            i0.ɵɵconditional(47, ((tmp_8_0 = ctx.disburseForm.get(\"disbursementMethod\")) == null ? null : tmp_8_0.invalid) && ((tmp_8_0 = ctx.disburseForm.get(\"disbursementMethod\")) == null ? null : tmp_8_0.touched) ? 47 : -1);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showBankFields());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showBankFields());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showBankFields());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showBankFields());\n            i0.ɵɵadvance(12);\n            i0.ɵɵtextInterpolate1(\"\", ((tmp_13_0 = ctx.disburseForm.get(\"remarks\")) == null ? null : tmp_13_0.value == null ? null : tmp_13_0.value.length) || 0, \"/500\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.isSubmitting());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.disburseForm.invalid || ctx.isSubmitting());\n            i0.ɵɵadvance();\n            i0.ɵɵconditional(68, ctx.isSubmitting() ? 68 : 69);\n          }\n        },\n        dependencies: [CommonModule, i5.NgIf, i5.DecimalPipe, ReactiveFormsModule, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.MaxLengthValidator, i1.FormGroupDirective, i1.FormControlName, MatDialogModule, i2.MatDialogTitle, i2.MatDialogActions, i2.MatDialogContent, MatFormFieldModule, i6.MatFormField, i6.MatLabel, i6.MatHint, i6.MatError, i6.MatSuffix, MatInputModule, i7.MatInput, MatButtonModule, i8.MatButton, MatProgressSpinnerModule, i9.MatProgressSpinner, MatSnackBarModule, MatSelectModule, i10.MatSelect, i11.MatOption, MatDatepickerModule, i12.MatDatepicker, i12.MatDatepickerInput, i12.MatDatepickerToggle, MatNativeDateModule, MatIconModule, i13.MatIcon],\n        styles: [\"mat-dialog-content[_ngcontent-%COMP%]{min-width:550px;max-width:650px;padding:24px}.loan-info[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:16px;border-radius:8px;margin-bottom:24px}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.info-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.label[_ngcontent-%COMP%]{font-weight:500;color:#0009}.value[_ngcontent-%COMP%]{font-weight:600;color:#000000de}.disburse-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.section-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin:16px 0 8px;padding-bottom:8px;border-bottom:2px solid rgba(102,126,234,.2)}.section-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#667eea}.section-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#667eea}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;gap:12px}mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin:0 auto}  .mat-mdc-dialog-container{border-radius:16px}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:100%;max-width:100%;padding:16px}.loan-info[_ngcontent-%COMP%]{padding:12px}.info-row[_ngcontent-%COMP%]{flex-direction:column;gap:4px;margin-bottom:12px}}\"]\n      });\n    }\n  }\n  return LoanDisburseDialogComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}