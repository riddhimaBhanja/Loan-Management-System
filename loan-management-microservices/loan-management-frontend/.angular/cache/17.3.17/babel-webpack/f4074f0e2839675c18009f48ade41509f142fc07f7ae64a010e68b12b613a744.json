{"ast":null,"code":"import { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@core/services/user.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/checkbox\";\nimport * as i8 from \"@angular/material/progress-spinner\";\nfunction UserRolesDialogComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"mat-checkbox\", 10);\n    i0.ɵɵlistener(\"change\", function UserRolesDialogComponent_div_16_Template_mat_checkbox_change_1_listener($event) {\n      const role_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.toggleRole(role_r2, $event.checked));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const role_r2 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"checked\", ctx_r2.isRoleSelected(role_r2));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", role_r2, \" \");\n  }\n}\nfunction UserRolesDialogComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelement(1, \"mat-spinner\", 12);\n    i0.ɵɵelementEnd();\n  }\n}\nexport let UserRolesDialogComponent = /*#__PURE__*/(() => {\n  class UserRolesDialogComponent {\n    constructor(fb, userService, snackBar, dialogRef, data) {\n      this.fb = fb;\n      this.userService = userService;\n      this.snackBar = snackBar;\n      this.dialogRef = dialogRef;\n      this.data = data;\n      this.availableRoles = signal([]);\n      this.selectedRoles = signal([]);\n      this.isLoading = signal(false);\n      this.rolesForm = this.fb.group({});\n    }\n    ngOnInit() {\n      // Initialize selected roles from user data\n      this.selectedRoles.set([...this.data.user.roles]);\n      // Load available roles\n      this.loadAvailableRoles();\n    }\n    loadAvailableRoles() {\n      this.isLoading.set(true);\n      this.userService.getAllRoles().subscribe({\n        next: response => {\n          if (response.success && response.data) {\n            this.availableRoles.set(response.data);\n          }\n          this.isLoading.set(false);\n        },\n        error: error => {\n          console.error('Error loading roles:', error);\n          this.snackBar.open('Failed to load available roles', 'Close', {\n            duration: 3000,\n            panelClass: ['error-snackbar']\n          });\n          this.isLoading.set(false);\n        }\n      });\n    }\n    isRoleSelected(role) {\n      return this.selectedRoles().includes(role);\n    }\n    toggleRole(role, checked) {\n      const currentRoles = [...this.selectedRoles()];\n      if (checked) {\n        if (!currentRoles.includes(role)) {\n          currentRoles.push(role);\n        }\n      } else {\n        const index = currentRoles.indexOf(role);\n        if (index > -1) {\n          currentRoles.splice(index, 1);\n        }\n      }\n      this.selectedRoles.set(currentRoles);\n    }\n    onSubmit() {\n      if (this.selectedRoles().length === 0) {\n        this.snackBar.open('At least one role must be selected', 'Close', {\n          duration: 3000,\n          panelClass: ['error-snackbar']\n        });\n        return;\n      }\n      this.isLoading.set(true);\n      this.userService.updateUserRoles(this.data.user.id, {\n        roles: this.selectedRoles()\n      }).subscribe({\n        next: response => {\n          this.isLoading.set(false);\n          this.snackBar.open('User roles updated successfully', 'Close', {\n            duration: 3000,\n            panelClass: ['success-snackbar']\n          });\n          this.dialogRef.close(true);\n        },\n        error: error => {\n          console.error('Error updating roles:', error);\n          this.isLoading.set(false);\n          this.snackBar.open(error.error?.message || 'Failed to update user roles', 'Close', {\n            duration: 5000,\n            panelClass: ['error-snackbar']\n          });\n        }\n      });\n    }\n    onCancel() {\n      this.dialogRef.close(false);\n    }\n    static {\n      this.ɵfac = function UserRolesDialogComponent_Factory(t) {\n        return new (t || UserRolesDialogComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.MatSnackBar), i0.ɵɵdirectiveInject(i4.MatDialogRef), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: UserRolesDialogComponent,\n        selectors: [[\"app-user-roles-dialog\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 23,\n        vars: 8,\n        consts: [[\"mat-dialog-title\", \"\"], [1, \"user-info\"], [1, \"roles-form\", 3, \"formGroup\"], [1, \"roles-container\"], [\"class\", \"role-checkbox\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"loading-overlay\", 4, \"ngIf\"], [\"align\", \"end\"], [\"mat-button\", \"\", 3, \"click\", \"disabled\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [1, \"role-checkbox\"], [3, \"change\", \"checked\"], [1, \"loading-overlay\"], [\"diameter\", \"40\"]],\n        template: function UserRolesDialogComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\", 0);\n            i0.ɵɵtext(1, \"Update User Roles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"mat-dialog-content\")(3, \"div\", 1)(4, \"p\")(5, \"strong\");\n            i0.ɵɵtext(6, \"User:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(7);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"p\")(9, \"strong\");\n            i0.ɵɵtext(10, \"Email:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(11);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"form\", 2)(13, \"div\", 3)(14, \"h3\");\n            i0.ɵɵtext(15, \"Select Roles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(16, UserRolesDialogComponent_div_16_Template, 3, 2, \"div\", 4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(17, UserRolesDialogComponent_div_17_Template, 2, 0, \"div\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"mat-dialog-actions\", 6)(19, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function UserRolesDialogComponent_Template_button_click_19_listener() {\n              return ctx.onCancel();\n            });\n            i0.ɵɵtext(20, \"Cancel\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function UserRolesDialogComponent_Template_button_click_21_listener() {\n              return ctx.onSubmit();\n            });\n            i0.ɵɵtext(22, \" Update Roles \");\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate2(\" \", ctx.data.user.fullName, \" (\", ctx.data.user.username, \")\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵtextInterpolate1(\" \", ctx.data.user.email, \"\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"formGroup\", ctx.rolesForm);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngForOf\", ctx.availableRoles());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isLoading());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.isLoading() || ctx.selectedRoles().length === 0);\n          }\n        },\n        dependencies: [CommonModule, i5.NgForOf, i5.NgIf, ReactiveFormsModule, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, MatDialogModule, i4.MatDialogTitle, i4.MatDialogActions, i4.MatDialogContent, MatButtonModule, i6.MatButton, MatCheckboxModule, i7.MatCheckbox, MatFormFieldModule, MatProgressSpinnerModule, i8.MatProgressSpinner, MatSnackBarModule],\n        styles: [\"mat-dialog-content[_ngcontent-%COMP%]{min-width:500px;min-height:300px;position:relative}.user-info[_ngcontent-%COMP%]{padding:16px;background:linear-gradient(135deg,#667eea14,#764ba20f);border-radius:12px;margin-bottom:24px}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;color:#000000de}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#0009;font-weight:600}.roles-form[_ngcontent-%COMP%]{padding:8px 0}.roles-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:16px;color:#000000de}.role-checkbox[_ngcontent-%COMP%]{padding:12px 8px;margin:4px 0;border-radius:8px;transition:background-color .3s ease}.role-checkbox[_ngcontent-%COMP%]:hover{background:#667eea0a}.role-checkbox[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{width:100%}.role-checkbox[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     .mdc-checkbox__background{border-color:#667eea!important}.role-checkbox[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     .mdc-checkbox--selected .mdc-checkbox__background{background-color:#667eea!important;border-color:#667eea!important}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;display:flex;align-items:center;justify-content:center;z-index:10;border-radius:4px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;margin:0}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}\"]\n      });\n    }\n  }\n  return UserRolesDialogComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}